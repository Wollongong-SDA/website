---
import Button from './Button.astro'
import { ASSET_URL, IMAGE_URL } from '../constants'
import getImageDetails from '../lib/imageHelper'
import { Picture } from 'astro:assets'
import { Image } from 'astro:assets'

interface Props {
  heading?: string
  headingImage?: string
  buttons?: Array<{
    text: string
    link: string
    newtab?: boolean
  }>
  image: string
}

const imageDetails = await getImageDetails(Astro.props.image)
---

<div class="flex flex-col items-start mx-auto my-8 lg:my-16 lg:h-96 container">
  <div class="w-95vw lg:w-70vw h-25vh lg:h-full self-center lg:self-start z-0 max-w-full">
    <Picture
      width={imageDetails.width}
      height={imageDetails.height}
      src={IMAGE_URL(Astro.props.image)}
      layout="constrained"
      class="h-full aspect-auto object-cover"
      alt=""
      formats={['avif', 'webp']}
      fallbackFormat="jpg"
      priority
    />
  </div>
  <div
    class="bg-glow px-4 mx-auto py-12 lg:p-16 lg:ml-16 mt-4 lg:my-30 lg:absolute w-full lg:max-w-2xl lg:text-left text-center self-end">
    {
      Astro.props.headingImage && (
        <Image src={ASSET_URL(Astro.props.headingImage)} alt="Heading Image" class="h-16 lg:h-20 mx-auto lg:ml-initial mb-4 object-contain lg:object-left" inferSize />
      )
    }
    {Astro.props.heading && <p class="heading-2 mb-4">{Astro.props.heading}</p>}
    <p class="text-charcoal text-lg font-400 mx-auto lg:mx-initial max-w-2xl"><slot /></p>
    {
      Astro.props.buttons && (
        <div class="pt-6 gap-2 flex flex-col items-center lg:flex-row">
          {Astro.props.buttons?.map((button) => (
            <Button link={button.link} newtab={button.newtab}>
              {button.text}
            </Button>
          ))}
        </div>
      )
    }
  </div>
</div>
